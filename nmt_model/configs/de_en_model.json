{
  "logging_project_name": "tda_nmt_models",
  "seed": 42,
  "model": {
    "src_vocab_size": 10000,
    "trg_vocab_size": 10000,
    "d_model": 512,
    "nhead": 4,
    "num_encoder_layers": 6,
    "num_decoder_layers": 6,
    "dim_feedforward": 1024,
    "dropout_transformer": 0.2,
    "padding_idx": 0,
    "max_length": 512,
    "emb_type": "shared"
  },
  "optimizer": {
    "type": "AdamW",
    "args": {
      "lr": 0,
      "weight_decay": 1e-5
    }
  },
  "scheduler": {
    "type": "OneCycleLR",
    "args": {
      "max_lr": 5e-4,
      "pct_start": 0.15,
      "epochs": 300,
      "steps_per_epoch": 1000
    }
  },
  "tokenizer": {
    "type": "SharedVocabTokenizer",
    "args": {
      "save_path": "../data/tokenizers/de_en-shared_bpe-10k",
      "model_args": {
        "data": [
          "../data/noisy.europarl.de-en.de",
          "../data/noisy.europarl.de-en.en"
        ],
        "vocab_size": 10000,
        "coverage": 0.9999,
        "pad_id": 0,
        "unk_id": 1,
        "bos_id": 2,
        "eos_id": 3
      }
    }
  },
  "data": {
    "train": {
      "datasets": [
        {
          "type": "CustomDataset",
          "args": {
            "src_path": "../data/noisy.europarl.de-en.de",
            "trg_path": "../data/noisy.europarl.de-en.en",
            "max_length": 256
          }
        }
      ],
      "dataloader": {
        "batch_size": 32,
        "num_workers": 2,
        "batch_sampler": {
          "type": "BucketSampler",
          "args": {
            "n_bins": 64
          }
        },
        "collate_fn": {
          "type": "PadCollatorFn",
          "args": {
            "padding_value": 0
          }
        }
      }
    },
    "val": {
      "datasets": [
        {
          "type": "CustomDataset",
          "args": {
            "src_path": "../data/clean.europarl.valid.de-en.de",
            "trg_path": "../data/clean.europarl.valid.de-en.en",
            "max_length": 256
          }
        }
      ],
      "dataloader": {
        "batch_size": 32,
        "num_workers": 2,
        "collate_fn": {
          "type": "PadCollatorFn",
          "args": {
            "padding_value": 0
          }
        }
      }
    }
  },
  "criterion": {
    "type": "CrossEntropyLoss",
    "args": {
      "ignore_index": 0,
      "label_smoothing": 0.1
    }
  },
  "trainer": {
    "num_epochs": 300,
    "len_epoch": 1000,
    "max_gradient_norm": 2.0,
    "save_epoch_step": 20,
    "log_step": 100,
    "acc_steps": 1
  }
}
